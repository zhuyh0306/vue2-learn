{"version":3,"file":"index.js","sources":["../src/utils.js","../src/observe/arr.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isObject(obj) {\n    //判断是否是对象\n    return obj !== null && typeof obj === 'object'\n}","\n//重写数组方法\n//（1）获取原来的数组方法\nlet oldArrayProtoMethods = Array.prototype\n//（2）继承\n\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\n//劫持\n\nlet methods = [\n    'push',\n    'pop',\n    'unshift',\n    'shift',\n    'splice',\n    'sort',\n    'reverse'\n]\n\nmethods.forEach((item) => {\n    arrayMethods[item] = function (...args) {\n\n        console.log('数组劫持了',args)\n        let result = oldArrayProtoMethods[item].apply(this, args)\n        let inserted\n        switch (item) {\n            case 'push':\n                inserted = args\n                break\n            case 'unshift':\n                inserted = args\n                break\n            case 'splice':\n                inserted = args.splice(2)\n                break\n        }\n        const ob = this.__ob__\n        if (inserted) {\n            ob.observeArray(inserted)\n        }\n        return result\n    }\n})","import { isObject } from \"../utils\"\nimport {arrayMethods} from './arr'\nexport function observe(data) {\n    // 判断如果不是对象,直接return\n    if (!isObject(data)) {\n        return data\n    }\n    new Observer(data)\n\n}\n// Observer类的作用：因为Object.defineProperty只能对对象的一个熟悉进行劫持，封装后可以对对象进行劫持\nclass Observer {\n    constructor(value) {\n        // 劫持数组时方便拿到Observer类上的方法\n        Object.defineProperty(value, '__ob__', {\n            enumerable: false,\n            value: this\n        })\n        if (Array.isArray(value)) {\n            // @ts-ignore\n            value.__proto__ = arrayMethods\n            this.observeArray(value)\n        } else {\n            this.walk(value)\n        }\n        \n    }\n    walk(value) {\n        let keys = Object.keys(value);\n        keys.forEach(key => {\n            //对每个属性进行劫持 \n            defineReactive(value,key,value[key])\n        });\n    }\n    observeArray(value) {\n        debugger\n        value.forEach(item => {\n            observe(item)\n        });\n    }\n}\n\nfunction defineReactive(data, key, value) {\n    observe(value)\n    Object.defineProperty(data,key, {\n        get() {\n            console.log('获取value值',data,key)\n            return value\n        }, \n        set(newVal) {\n            if (newVal === value) return\n            console.log('set')\n            // 如果设置的值是对象，还要深度劫持\n            observe(newVal)\n            value = newVal\n        }\n    })\n}","import { observe} from \"./observe/index\"\n\nexport function initState(vm) {\n    let opt = vm.$options\n    console.log(opt)\n    if (opt.props) {\n        initProps(vm)\n    }\n    if (opt.methods) {\n        initMethods(vm)\n    }\n    if (opt.data) {\n        initData(vm)\n    }\n    if (opt.computed) {\n        initComputed(vm)\n    }\n    if (opt.watch) { \n        initWatch(vm)\n    }\n}\nfunction initProps(vm) {\n    console.log('initProps')\n}\n\nfunction initMethods(vm) {\n    console.log('initMethods')\n    \n}\n/**\n * 初始化data\n */\nfunction initData(vm) {\n\n    console.log('initData')\n    let data = vm.$options.data;\n    data = typeof data === 'function' ? data.call(vm) : data\n    vm._data = data\n    // 将data 上的属性代理到实例上 vm.mes = vm._data.mes\n    for (let key in data) {\n        proxy(vm,'_data',key)\n    }\n    //对数据进行劫持\n    observe(data)\n\n}\n // 将data 上的属性代理到实例上 vm.mes = vm._data.mes\nfunction proxy(vm, source, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[source][key]\n        },\n        set(newVal) {\n            vm[source][key] = newVal\n        }\n    })\n}\n \nfunction initComputed(vm) {\n    console.log('initComputed')\n}\nfunction initWatch(vm) {\n    console.log('initWatch')\n}","import { initState } from \"./initState\";\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        console.log(options)\n        const vm = this;\n        vm.$options = options;\n        //初始化状态\n        initState(vm)\n    }\n}","import {initMixin} from './init'\nfunction Vue(options) {\n\n//初始化  \n this._init(options)\n}\ninitMixin(Vue) \nexport default Vue\n"],"names":["isObject","obj","_typeof","oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","item","_len","arguments","length","args","_key","console","log","result","apply","inserted","splice","ob","__ob__","observeArray","observe","data","Observer","value","_classCallCheck","defineProperty","enumerable","isArray","__proto__","walk","_createClass","key","keys","defineReactive","get","set","newVal","initState","vm","opt","$options","props","initProps","initMethods","initData","computed","initComputed","watch","initWatch","call","_data","proxy","source","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,SAASA,QAAQA,CAACC,GAAG,EAAE;EAC1B;IACA,OAAOA,GAAG,KAAK,IAAI,IAAIC,OAAA,CAAOD,GAAG,MAAK,QAAQ,CAAA;EAClD;;ECFA;EACA;EACA,IAAIE,oBAAoB,GAAGC,KAAK,CAACC,SAAS,CAAA;EAC1C;;EAEO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAM,CAACL,oBAAoB,CAAC,CAAA;EAC7D;;EAEA,IAAIM,OAAO,GAAG,CACV,MAAM,EACN,KAAK,EACL,SAAS,EACT,OAAO,EACP,QAAQ,EACR,MAAM,EACN,SAAS,CACZ,CAAA;EAEDA,OAAO,CAACC,OAAO,CAAC,UAACC,IAAI,EAAK;EACtBL,EAAAA,YAAY,CAACK,IAAI,CAAC,GAAG,YAAmB;EAAA,IAAA,KAAA,IAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAANC,IAAI,GAAAX,IAAAA,KAAA,CAAAQ,IAAA,GAAAI,IAAA,GAAA,CAAA,EAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA,EAAA,EAAA;EAAJD,MAAAA,IAAI,CAAAC,IAAA,CAAAH,GAAAA,SAAA,CAAAG,IAAA,CAAA,CAAA;EAAA,KAAA;EAElCC,IAAAA,OAAO,CAACC,GAAG,CAAC,OAAO,EAACH,IAAI,CAAC,CAAA;EACzB,IAAA,IAAII,MAAM,GAAGhB,oBAAoB,CAACQ,IAAI,CAAC,CAACS,KAAK,CAAC,IAAI,EAAEL,IAAI,CAAC,CAAA;EACzD,IAAA,IAAIM,QAAQ,CAAA;EACZ,IAAA,QAAQV,IAAI;EACR,MAAA,KAAK,MAAM;EACPU,QAAAA,QAAQ,GAAGN,IAAI,CAAA;EACf,QAAA,MAAA;EACJ,MAAA,KAAK,SAAS;EACVM,QAAAA,QAAQ,GAAGN,IAAI,CAAA;EACf,QAAA,MAAA;EACJ,MAAA,KAAK,QAAQ;EACTM,QAAAA,QAAQ,GAAGN,IAAI,CAACO,MAAM,CAAC,CAAC,CAAC,CAAA;EACzB,QAAA,MAAA;EAAK,KAAA;EAEb,IAAA,IAAMC,EAAE,GAAG,IAAI,CAACC,MAAM,CAAA;EACtB,IAAA,IAAIH,QAAQ,EAAE;EACVE,MAAAA,EAAE,CAACE,YAAY,CAACJ,QAAQ,CAAC,CAAA;EAC7B,KAAA;EACA,IAAA,OAAOF,MAAM,CAAA;KAChB,CAAA;EACL,CAAC,CAAC;;ECxCK,SAASO,OAAOA,CAACC,IAAI,EAAE;EAC1B;EACA,EAAA,IAAI,CAAC3B,QAAQ,CAAC2B,IAAI,CAAC,EAAE;EACjB,IAAA,OAAOA,IAAI,CAAA;EACf,GAAA;IACA,IAAIC,QAAQ,CAACD,IAAI,CAAC,CAAA;EAEtB,CAAA;EACA;EAAA,IACMC,QAAQ,gBAAA,YAAA;IACV,SAAAA,QAAAA,CAAYC,KAAK,EAAE;EAAAC,IAAAA,eAAA,OAAAF,QAAA,CAAA,CAAA;EACf;EACArB,IAAAA,MAAM,CAACwB,cAAc,CAACF,KAAK,EAAE,QAAQ,EAAE;EACnCG,MAAAA,UAAU,EAAE,KAAK;EACjBH,MAAAA,KAAK,EAAE,IAAA;EACX,KAAC,CAAC,CAAA;EACF,IAAA,IAAIzB,KAAK,CAAC6B,OAAO,CAACJ,KAAK,CAAC,EAAE;EACtB;QACAA,KAAK,CAACK,SAAS,GAAG5B,YAAY,CAAA;EAC9B,MAAA,IAAI,CAACmB,YAAY,CAACI,KAAK,CAAC,CAAA;EAC5B,KAAC,MAAM;EACH,MAAA,IAAI,CAACM,IAAI,CAACN,KAAK,CAAC,CAAA;EACpB,KAAA;EAEJ,GAAA;EAACO,EAAAA,YAAA,CAAAR,QAAA,EAAA,CAAA;MAAAS,GAAA,EAAA,MAAA;EAAAR,IAAAA,KAAA,EACD,SAAAM,IAAKN,CAAAA,KAAK,EAAE;EACR,MAAA,IAAIS,IAAI,GAAG/B,MAAM,CAAC+B,IAAI,CAACT,KAAK,CAAC,CAAA;EAC7BS,MAAAA,IAAI,CAAC5B,OAAO,CAAC,UAAA2B,GAAG,EAAI;EAChB;UACAE,cAAc,CAACV,KAAK,EAACQ,GAAG,EAACR,KAAK,CAACQ,GAAG,CAAC,CAAC,CAAA;EACxC,OAAC,CAAC,CAAA;EACN,KAAA;EAAC,GAAA,EAAA;MAAAA,GAAA,EAAA,cAAA;EAAAR,IAAAA,KAAA,EACD,SAAAJ,YAAaI,CAAAA,KAAK,EAAE;EAChB,MAAA,SAAA;EACAA,MAAAA,KAAK,CAACnB,OAAO,CAAC,UAAAC,IAAI,EAAI;UAClBe,OAAO,CAACf,IAAI,CAAC,CAAA;EACjB,OAAC,CAAC,CAAA;EACN,KAAA;EAAC,GAAA,CAAA,CAAA,CAAA;EAAA,EAAA,OAAAiB,QAAA,CAAA;EAAA,CAAA,EAAA,CAAA;EAGL,SAASW,cAAcA,CAACZ,IAAI,EAAEU,GAAG,EAAER,KAAK,EAAE;IACtCH,OAAO,CAACG,KAAK,CAAC,CAAA;EACdtB,EAAAA,MAAM,CAACwB,cAAc,CAACJ,IAAI,EAACU,GAAG,EAAE;MAC5BG,GAAG,EAAA,SAAAA,MAAG;QACFvB,OAAO,CAACC,GAAG,CAAC,UAAU,EAACS,IAAI,EAACU,GAAG,CAAC,CAAA;EAChC,MAAA,OAAOR,KAAK,CAAA;OACf;MACDY,GAAG,EAAA,SAAAA,GAACC,CAAAA,MAAM,EAAE;QACR,IAAIA,MAAM,KAAKb,KAAK,EAAE,OAAA;EACtBZ,MAAAA,OAAO,CAACC,GAAG,CAAC,KAAK,CAAC,CAAA;EAClB;QACAQ,OAAO,CAACgB,MAAM,CAAC,CAAA;EACfb,MAAAA,KAAK,GAAGa,MAAM,CAAA;EAClB,KAAA;EACJ,GAAC,CAAC,CAAA;EACN;;ECvDO,SAASC,SAASA,CAACC,EAAE,EAAE;EAC1B,EAAA,IAAIC,GAAG,GAAGD,EAAE,CAACE,QAAQ,CAAA;EACrB7B,EAAAA,OAAO,CAACC,GAAG,CAAC2B,GAAG,CAAC,CAAA;IAChB,IAAIA,GAAG,CAACE,KAAK,EAAE;MACXC,SAAS,CAAG,CAAC,CAAA;EACjB,GAAA;IACA,IAAIH,GAAG,CAACpC,OAAO,EAAE;MACbwC,WAAW,CAAG,CAAC,CAAA;EACnB,GAAA;IACA,IAAIJ,GAAG,CAAClB,IAAI,EAAE;MACVuB,QAAQ,CAACN,EAAE,CAAC,CAAA;EAChB,GAAA;IACA,IAAIC,GAAG,CAACM,QAAQ,EAAE;MACdC,YAAY,CAAG,CAAC,CAAA;EACpB,GAAA;IACA,IAAIP,GAAG,CAACQ,KAAK,EAAE;MACXC,SAAS,CAAG,CAAC,CAAA;EACjB,GAAA;EACJ,CAAA;EACA,SAASN,SAASA,CAACJ,EAAE,EAAE;EACnB3B,EAAAA,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC,CAAA;EAC5B,CAAA;EAEA,SAAS+B,WAAWA,CAACL,EAAE,EAAE;EACrB3B,EAAAA,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC,CAAA;EAE9B,CAAA;EACA;EACA;EACA;EACA,SAASgC,QAAQA,CAACN,EAAE,EAAE;EAElB3B,EAAAA,OAAO,CAACC,GAAG,CAAC,UAAU,CAAC,CAAA;EACvB,EAAA,IAAIS,IAAI,GAAGiB,EAAE,CAACE,QAAQ,CAACnB,IAAI,CAAA;EAC3BA,EAAAA,IAAI,GAAG,OAAOA,IAAI,KAAK,UAAU,GAAGA,IAAI,CAAC4B,IAAI,CAACX,EAAE,CAAC,GAAGjB,IAAI,CAAA;IACxDiB,EAAE,CAACY,KAAK,GAAG7B,IAAI,CAAA;EACf;EACA,EAAA,KAAK,IAAIU,GAAG,IAAIV,IAAI,EAAE;EAClB8B,IAAAA,KAAK,CAACb,EAAE,EAAC,OAAO,EAACP,GAAG,CAAC,CAAA;EACzB,GAAA;EACA;IACAX,OAAO,CAACC,IAAI,CAAC,CAAA;EAEjB,CAAA;EACC;EACD,SAAS8B,KAAKA,CAACb,EAAE,EAAEc,MAAM,EAAErB,GAAG,EAAE;EAC5B9B,EAAAA,MAAM,CAACwB,cAAc,CAACa,EAAE,EAAEP,GAAG,EAAE;MAC3BG,GAAG,EAAA,SAAAA,MAAG;EACF,MAAA,OAAOI,EAAE,CAACc,MAAM,CAAC,CAACrB,GAAG,CAAC,CAAA;OACzB;MACDI,GAAG,EAAA,SAAAA,GAACC,CAAAA,MAAM,EAAE;EACRE,MAAAA,EAAE,CAACc,MAAM,CAAC,CAACrB,GAAG,CAAC,GAAGK,MAAM,CAAA;EAC5B,KAAA;EACJ,GAAC,CAAC,CAAA;EACN,CAAA;EAEA,SAASU,YAAYA,CAACR,EAAE,EAAE;EACtB3B,EAAAA,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC,CAAA;EAC/B,CAAA;EACA,SAASoC,SAASA,CAACV,EAAE,EAAE;EACnB3B,EAAAA,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC,CAAA;EAC5B;;EC7DO,SAASyC,SAASA,CAACC,GAAG,EAAE;EAC3BA,EAAAA,GAAG,CAACvD,SAAS,CAACwD,KAAK,GAAG,UAAUC,OAAO,EAAE;EACrC7C,IAAAA,OAAO,CAACC,GAAG,CAAC4C,OAAO,CAAC,CAAA;MACpB,IAAMlB,EAAE,GAAG,IAAI,CAAA;MACfA,EAAE,CAACE,QAAQ,GAAGgB,OAAO,CAAA;EACrB;MACAnB,SAAS,CAACC,EAAE,CAAC,CAAA;KAChB,CAAA;EACL;;ECTA,SAASgB,GAAGA,CAACE,OAAO,EAAE;EAEtB;EACC,EAAA,IAAI,CAACD,KAAK,CAACC,OAAO,CAAC,CAAA;EACpB,CAAA;EACAH,SAAS,CAACC,GAAG,CAAC;;;;;;;;"}